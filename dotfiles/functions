# -*- mode: sh -*-

# Change Python env for CW.
function cwenv
{
    export _OLD_CWENV_PATH=$PATH
    export _OLD_CWENV_PYTHONPATH=$PYTHONPATH
    export _OLD_CWENV_PS1=$PS1

    export PATH="$(pwd)/cubicweb/bin:$PATH"
    export PYTHONPATH=$(pwd):$PYTHONPATH
    export PS1="[cwenv]$PS1"
    export PGCLUSTER="9.1/main"
}

# Get back env. from CWENV
function cwenvback
{
    export PATH=$_OLD_CWENV_PATH
    export PYTHONPATH=$_OLD_CWENV_PYTHONPATH
    export PS1=$_OLD_CWENV_PS1
    unset _OLD_CWENV_PATH
    unset _OLD_CWENV_PYTHONPATH
    unset _OLD_CWENV_PS1
}

function f
{
    # Find a pattern for a specific extension file (uncase-sensitive pattern).
    ext=$1
    pattern=$2
    find $PWD -type f -iname "*$pattern*.$ext" -print
}

function pyv
{
    # Try to find the current version of a specific package.
    if [ "$#" -eq 1 ]; then
        _pypkg=$1
        echo $_pypkg `python -c "import $_pypkg;print($_pypkg.__version__)"`
    else
        echo "Need one Python package name.";
    fi
}

function c
{
    # Launch a compilation with 'make'. It's possible to pass the number of
    # cores for parallel compilation.
    if [ "$#" -eq 1 ]; then
        chrt -i 0 make -j $1
    elif [ "$#" -eq 2 ]; then
        chrt -i 0 make -j $1 $2 # to pass the target
    else
        chrt -i 0 make
    fi
}

function _jh-prev-result
{
    # Re-launch last command and save the result. It's possible to use it when
    # you have a list of files printed out by a 'find' and you want to open one
    # of these files.
    # From: "Tip of the day: previous command output"
    # http://www.zsh.org/mla/users/2004/msg00966.html
    hstring=$(eval `fc -l -n -1`)
    set -A hlist ${(@s/
/)hstring}
    compadd - ${hlist}
}

zle -C jh-prev-comp menu-complete _jh-prev-result
bindkey '\ee' jh-prev-comp # Alt-e
